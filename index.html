<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Test bruteSQL</title>
  <script src="/angular/angular.min.js"></script>
  <script>
  const app = angular.module('app',[]);
  app.controller('main', function($scope, $http, Ajax){

    $scope.running = true;
    $scope.values = [];
    $scope.tab = [];
    $scope.Tables = [];
    //$scope.allTables = [];
    $scope.$watch(function(){ return $scope.allTables; }, function(){ console.log('watch:', $scope.allTables); },true);
    $scope.$watch(function(){ return $scope.Tables; }, function(){ console.log('watch:', $scope.Tables);
      let tables = $scope.Tables;
      let data = {};
      let i = 0;
      let len = tables.length;
      tables.forEach(function(table){
        Ajax.call({action:'select', table:table}, function(res){
          data[table] = res.data;
          if(i == len-1){ update(data); }
          i++;
        });
    });
    },true);
    //setInterval(function(){ console.log($scope.allTables); },2000);
    function update(data){
      $scope.allTables = data;
    }

    Ajax.call({action:'alltables'},function(res){
      $scope.Tables = res.data;
    });
  });
  app.service('Ajax',function($http){
    this.call = function(data, callback){
      $http({ method: 'POST', url: 'brutesql.php', data: data})
      .then( function(res){ callback(res);}, function(res){} );
    }
  });
  </script>
  <style>
  table {
      border-collapse: collapse;
  }

  table, th, td {
      border-bottom: 1px solid #ddd;
      padding: 8px 8px;
      text-align: left;
  }
  th {
    background-color: #4CAF50;
    color: white;
}
  tr:nth-child(even) {background-color: #f2f2f2}
  </style>
  </head>


  <body ng-app="app" ng-controller="main">
    AngularJS:  {{running}}

  <div ng-repeat="(name,rows) in allTables track by $index">
    <h2>{{name}}</h2>
    <table>
      <tr><th ng-repeat="(key,val) in rows[0]">{{key}}</th></tr>
      <tr ng-repeat="value in rows track by $index">
        <td ng-repeat="val in value">
          {{val}}
        </td>
      </tr>
    </table>
  </div>
  </body>


</html>
